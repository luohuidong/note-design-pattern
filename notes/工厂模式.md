# 工厂模式

工厂模式是一种常见的设计模式，用于创建对象。它的主要目的是封装对象创建的过程，使得客户端代码与具体创建逻辑解耦，提高代码的可维护性、可扩展性和灵活性。

工厂模式可分为两类：

- 工厂方法模式
- 抽象工厂模式

需要注意的是，我们常常听到的简单工厂其实不是一个设计模式，更多是一种编程习惯，但是很多人误以为它是工厂模式。虽然简单工厂不是设计模式，但我们仍然在了解工厂方法模式以及抽象工厂模式之前先了解一下简单工厂。

## 简单工厂

简单工厂的作用是将对象的创建和使用分离，将对象的创建交给一个工厂类来负责。假设一个披萨店处理披萨订单的场景：

```ts
abstract class Pizza {
  /** 准备操作 */
  prepare() {}
  /** 烘烤操作 */
  bake() {}
  /** 裁剪操作 */
  cut() {}
  /** 打包操作 */
  box() {}
}

class CheesePizza extends Pizza {}
class GreekPizza extends Pizza {}
class PepperoniPizza extends Pizza {}
class NormalPizza extends Pizza {}

class PizzaStore {
  orderPizza(type: string) {
    let pizza!: Pizza;

    if (type === "cheese") {
      pizza = new CheesePizza();
    } else if (type === "greek") {
      pizza = new GreekPizza();
    } else if (type === "pepperoni") {
      pizza = new PepperoniPizza();
    } else {
      pizza = new NormalPizza();
    }

    pizza.prepare();
    pizza.bake();
    pizza.cut();
    pizza.box();

    return pizza;
  }
}
```

披萨店是很有可能根据经营状况上架或者下架披萨的，这就意味着当披萨种类发生变化的时候，`PizzaStore` 的 `orderPizza` 方法中对披萨的实例化逻辑也需要跟着修改。可以预见，随着时间的推移，披萨种类的不断变化，`orderPizza` 中 pizza 实例化的代码也会一遍遍地修改。这样的代码是违反了开闭原则的，没法对修改关闭。

上面提到的问题，可以使用“简单工厂”来解决这个问题。我们将创建 Pizza 的逻辑放到一个只操心如何创建 Pizza 的对象，这个对象我们称之为工厂：

```ts
class SimplePizzaFactory {
  createPizza(type: string) {
    let pizza!: Pizza;

    if (type === "cheese") {
      pizza = new CheesePizza();
    } else if (type === "greek") {
      pizza = new GreekPizza();
    } else if (type === "pepperoni") {
      pizza = new PepperoniPizza();
    }

    return pizza;
  }
}

class PizzaStore {
  factory: SimplePizzaFactory;
  constructor(factory: SimplePizzaFactory) {
    this.factory = factory;
  }

  orderPizza(type: string) {
    const pizza = this.factory.createPizza(type);

    pizza.prepare();
    pizza.bake();
    pizza.cut();
    pizza.box();

    return pizza;
  }
}
```

经过改造后，我们将 Pizza 的创建逻辑封装到 `SimplePizzaFactory` 中，并通过对象组合的方式将工厂类注入到 `PizzaStore` 中，这样后面有不同的 Pizza 简单工厂类就不需要更改 `PizzaStore` 中的逻辑了。

## 工厂方法模式

现在假设批萨店开得不错，需要开加盟店。而加盟店由于地域的不同需要制作不同风味的批萨。
